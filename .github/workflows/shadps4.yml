name: Build shadPS4 for ARM64 Linux

on:
  workflow_dispatch:

jobs:
  build-arm64:
    runs-on: ubuntu-latest
    name: Build on ARM64 Ubuntu
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: Set up QEMU for ARM64
        uses: docker/setup-qemu-action@v2
        with:
          platforms: arm64

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y build-essential clang git cmake libasound2-dev \
            libpulse-dev libopenal-dev libssl-dev zlib1g-dev libedit-dev \
            libudev-dev libevdev-dev libsdl2-dev libjack-dev libsndio-dev \
            libvulkan-dev vulkan-validationlayers libpng-dev

      - name: Configure CMake
        run: cmake -S . -B build/ -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++

      - name: Build project
        run: cmake --build ./build --parallel $(nproc)

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: shadPS4-arm64-binaries
          path: build/
