name: Build Arti

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Explicitly clone the external repository
      - name: Clone arti repo
        run: git clone https://github.com/zydou/arti.git

      # Set up Rust (version >= 1.86)
      - name: Set up Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: 1.87.0

      # Add ARM64 target
      - name: Add ARM64 target
        run: rustup target add aarch64-unknown-linux-gnu

      # Install cross compiler toolchain
      - name: Install cross compiler
        run: sudo apt-get update && sudo apt-get install -y gcc-aarch64-linux-gnu

      # Verify Rust version
      - name: Check Rust version
        run: rustc --version

      # Build the project for ARM64
      - name: Build arti (ARM64)
        working-directory: arti
        run: cargo build -p arti --locked --release --target aarch64-unknown-linux-gnu

      # Upload ARM64 build artifact
      - name: Upload arti ARM64 binary
        uses: actions/upload-artifact@v4
        with:
          name: arti-binary-arm64
          path: arti/target/aarch64-unknown-linux-gnu/release/arti
