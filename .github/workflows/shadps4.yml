name: Build shadPS4 for ARM64 Linux

on:
  workflow_dispatch:
  
jobs:
  build-arm64:
    runs-on: ubuntu-latest
    name: Build shadPS4 on ARM64

    steps:
      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y build-essential clang git cmake libasound2-dev \
            libpulse-dev libopenal-dev libssl-dev zlib1g-dev libedit-dev \
            libudev-dev libevdev-dev libsdl2-dev libjack-dev libsndio-dev \
            libvulkan-dev vulkan-validationlayers libpng-dev

      - name: Clone shadPS4 repository
        run: |
          git clone --recursive https://github.com/shadps4-emu/shadPS4.git
          cd shadPS4

      - name: Configure CMake
        working-directory: shadPS4
        run: cmake -S . -B build/ -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++

      - name: Build project
        working-directory: shadPS4
        run: cmake --build ./build --parallel $(nproc)

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: shadPS4-arm64-binaries
          path: shadPS4/build/
